<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue2笔记 | Yuan Blog</title>
    <meta name="description" content="远美网是一个vite与vitepress搭建的静态站点，记录着工作中有意义的事情，提供技术支持。">
    <link rel="preload stylesheet" href="/assets/style.3fc8fab7.css" as="style">
    
    <script type="module" src="/assets/app.6b52a9b6.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.419948d5.js">
    <link rel="modulepreload" href="/assets/chunks/theme.77892cca.js">
    <link rel="modulepreload" href="/assets/note_base-vue.md.53a8e7dc.lean.js">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <meta name="keywords" content="JavaScript,Vue,Vue2,Vue3,响应式">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-f07d512f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-785ce7e5></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-785ce7e5> Skip to content </a><!--]--><!----><header class="VPNav" data-v-f07d512f data-v-a12ab3c1><div class="VPNavBar has-sidebar" data-v-a12ab3c1 data-v-d7f68dd9><div class="container" data-v-d7f68dd9><div class="title" data-v-d7f68dd9><div class="VPNavBarTitle has-sidebar" data-v-d7f68dd9 data-v-8649ebf6><a class="title" href="/" data-v-8649ebf6><!--[--><!--]--><!----><!--[-->Yuan Blog<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-d7f68dd9><div class="curtain" data-v-d7f68dd9></div><div class="content-body" data-v-d7f68dd9><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-d7f68dd9><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-d7f68dd9 data-v-c383713b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-c383713b data-v-26fb176d data-v-476ec6cb><span class="check" data-v-476ec6cb><span class="icon" data-v-476ec6cb><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-26fb176d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-26fb176d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-d7f68dd9 data-v-44ea7c6c data-v-99c51fca><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-99c51fca><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-99c51fca><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-99c51fca><div class="VPMenu" data-v-99c51fca data-v-522ff826><!----><!--[--><!--[--><!----><div class="group" data-v-44ea7c6c><div class="item appearance" data-v-44ea7c6c><p class="label" data-v-44ea7c6c>Appearance</p><div class="appearance-action" data-v-44ea7c6c><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-44ea7c6c data-v-26fb176d data-v-476ec6cb><span class="check" data-v-476ec6cb><span class="icon" data-v-476ec6cb><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-26fb176d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-26fb176d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-d7f68dd9 data-v-679bb115><span class="container" data-v-679bb115><span class="top" data-v-679bb115></span><span class="middle" data-v-679bb115></span><span class="bottom" data-v-679bb115></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-f07d512f data-v-00c86225><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-00c86225><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-00c86225><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-00c86225>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-00c86225 data-v-653b1d93><button data-v-653b1d93>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-f07d512f data-v-163a881b><div class="curtain" data-v-163a881b></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-163a881b><span class="visually-hidden" id="sidebar-aria-label" data-v-163a881b> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-163a881b><section class="VPSidebarItem level-0 has-active" data-v-163a881b data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h2 class="text" data-v-05ebbe1e>目录</h2><!----></div><div class="items" data-v-05ebbe1e><!--[--><section class="VPSidebarItem level-1" data-v-05ebbe1e data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h3 class="text" data-v-05ebbe1e>HTML</h3><!----></div><div class="items" data-v-05ebbe1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-html.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>html基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-flex.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>flex基础</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-05ebbe1e data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h3 class="text" data-v-05ebbe1e>CSS</h3><!----></div><div class="items" data-v-05ebbe1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-css-layout.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>探索弹性布局</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/css3.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>探索CSS3</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/css-hack.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>css hack</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-05ebbe1e data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h3 class="text" data-v-05ebbe1e>JsvsScript</h3><!----></div><div class="items" data-v-05ebbe1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-javaScript.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>JavaScript基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/javascript-stringify.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>stringify的奇妙用法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/javascript-toString.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>toString的奇妙用法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/arithmetic-javaScript.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>操作数组</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/sort-javaScript.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>数组中sort的使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/debounce-throttle.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>节流与防抖</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/postfrom-jQuery.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>模拟form</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/url-json.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>url参数转化JSON</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/clone-javaScript.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>clone</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-05ebbe1e data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h3 class="text" data-v-05ebbe1e>Mustache</h3><!----></div><div class="items" data-v-05ebbe1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/template-mustache.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>Mustache</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-05ebbe1e data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h3 class="text" data-v-05ebbe1e>web safe</h3><!----></div><div class="items" data-v-05ebbe1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/web-safe.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>学习web safe</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-05ebbe1e data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h3 class="text" data-v-05ebbe1e>ES6</h3><!----></div><div class="items" data-v-05ebbe1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-es6.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>ES6</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-05ebbe1e data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h3 class="text" data-v-05ebbe1e>webPack</h3><!----></div><div class="items" data-v-05ebbe1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-webpack.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>入门webPack</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-05ebbe1e data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h3 class="text" data-v-05ebbe1e>React16.x</h3><!----></div><div class="items" data-v-05ebbe1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-react16.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>React</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-reactHooks.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>reactHooks</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-reactRouter.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>reactRouter</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 has-active" data-v-05ebbe1e data-v-05ebbe1e><div class="item" role="button" tabindex="0" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><h3 class="text" data-v-05ebbe1e>Vue</h3><!----></div><div class="items" data-v-05ebbe1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-vue.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>Vue2</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/vue-for-ref.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>ref</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/base-vue3.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>Vue3</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/elementUIPlus-drawer.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>elementPlusDrawer</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-05ebbe1e data-v-05ebbe1e><div class="item" data-v-05ebbe1e><div class="indicator" data-v-05ebbe1e></div><a class="VPLink link link" href="/note/phone-input.html" data-v-05ebbe1e><!--[--><p class="text" data-v-05ebbe1e>验证码输入框</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-f07d512f data-v-49eaefa3><div class="VPDoc has-sidebar has-aside" data-v-49eaefa3 data-v-40b5f150><!--[--><!--]--><div class="container" data-v-40b5f150><div class="aside" data-v-40b5f150><div class="aside-curtain" data-v-40b5f150></div><div class="aside-container" data-v-40b5f150><div class="aside-content" data-v-40b5f150><div class="VPDocAside" data-v-40b5f150 data-v-bd61eb2b><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-bd61eb2b data-v-52e5b8d5><div class="content" data-v-52e5b8d5><div class="outline-marker" data-v-52e5b8d5></div><div class="outline-title" role="heading" data-v-52e5b8d5>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-52e5b8d5><span class="visually-hidden" id="doc-outline-aria-label" data-v-52e5b8d5> Table of Contents for current page </span><ul class="root" data-v-52e5b8d5 data-v-3bd8db25><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-bd61eb2b></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-40b5f150><div class="content-container" data-v-40b5f150><!--[--><!--]--><!----><main class="main" data-v-40b5f150><div style="position:relative;" class="vp-doc _note_base-vue" data-v-40b5f150><div><p><strong>前言</strong> Vue是参考mvvm模式设计的一套用于构建用户界面的渐进式框架，可以自底向上逐层应用，采用非侵入性的响应式系统。在修改数据时，视图也会跟着更新，开发过程中只需关注数据。</p><h3 id="开发中的响应式" tabindex="-1">开发中的响应式： <a class="header-anchor" href="#开发中的响应式" aria-label="Permalink to &quot;开发中的响应式：&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">&lt;template&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">  &lt;div id=&quot;app&quot;&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">    &lt;p&gt;数量：{{ num }}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">    &lt;p&gt;价格：{{ num * price }}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">    &lt;p&gt;总计：{{ total }}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">    &lt;button @click=&quot;btn&quot;&gt;点击按钮&lt;/button&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">  &lt;/div&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">&lt;/template&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">&lt;template&gt;</span></span>
<span class="line"><span style="color:#24292e;">  &lt;div id=&quot;app&quot;&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;p&gt;数量：{{ num }}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;p&gt;价格：{{ num * price }}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;p&gt;总计：{{ total }}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#24292e;">    &lt;button @click=&quot;btn&quot;&gt;点击按钮&lt;/button&gt;</span></span>
<span class="line"><span style="color:#24292e;">  &lt;/div&gt;</span></span>
<span class="line"><span style="color:#24292e;">&lt;/template&gt;</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">&lt;script&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">expprt default {</span></span>
<span class="line"><span style="color:#e1e4e8;">  data() {</span></span>
<span class="line"><span style="color:#e1e4e8;">    return {</span></span>
<span class="line"><span style="color:#e1e4e8;">      num: 1,</span></span>
<span class="line"><span style="color:#e1e4e8;">      price: 2</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">  },</span></span>
<span class="line"><span style="color:#e1e4e8;">  computed: {</span></span>
<span class="line"><span style="color:#e1e4e8;">    total: function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">      return this.num * this.price;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">  },</span></span>
<span class="line"><span style="color:#e1e4e8;">  methods: {</span></span>
<span class="line"><span style="color:#e1e4e8;">    btn: function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">      this.num = 10;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">&lt;/script&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">&lt;script&gt;</span></span>
<span class="line"><span style="color:#24292e;">expprt default {</span></span>
<span class="line"><span style="color:#24292e;">  data() {</span></span>
<span class="line"><span style="color:#24292e;">    return {</span></span>
<span class="line"><span style="color:#24292e;">      num: 1,</span></span>
<span class="line"><span style="color:#24292e;">      price: 2</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">  },</span></span>
<span class="line"><span style="color:#24292e;">  computed: {</span></span>
<span class="line"><span style="color:#24292e;">    total: function() {</span></span>
<span class="line"><span style="color:#24292e;">      return this.num * this.price;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">  },</span></span>
<span class="line"><span style="color:#24292e;">  methods: {</span></span>
<span class="line"><span style="color:#24292e;">    btn: function() {</span></span>
<span class="line"><span style="color:#24292e;">      this.num = 10;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">&lt;/script&gt;</span></span></code></pre></div><p>页面属性num发生变化时，经历了</p><ul><li>获取属性num</li><li>更新属性num值</li><li>计算total值，更新页面 数据发生变化后，页面会重新更新数据。</li></ul><p>想要完成整个过程，需要：</p><ul><li>侦测数据变化 (简称：数据劫持)</li><li>收集视图依赖数据 (简称：依赖收集)</li><li>数据变化，通知视图需要更新的部分 (简称：发布订阅模式)</li></ul><h3 id="数据劫持" tabindex="-1">数据劫持 <a class="header-anchor" href="#数据劫持" aria-label="Permalink to &quot;数据劫持&quot;">​</a></h3><p>Vue2.x版本中使用Object.defineProperty进行数据劫持。</p><p>Vue通过对象属性getter/setter监听数据变化，通过getter进行依赖收集，每个setter方法就是一个观察者，数据发生变化时通知订阅者更新视图。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">var data = {</span></span>
<span class="line"><span style="color:#e1e4e8;">  title: &#39;Vue&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  obj: {</span></span>
<span class="line"><span style="color:#e1e4e8;">    age: 6</span></span>
<span class="line"><span style="color:#e1e4e8;">  }  </span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">function observer(data) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  if(data &amp;&amp; typeof data == &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    Object.keys(data).forEach(function(key) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      defineReactive(data, key, data[key]);</span></span>
<span class="line"><span style="color:#e1e4e8;">    })</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">function defineReactive(data, key, value) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  observer(value); // 劫持每一层数据</span></span>
<span class="line"><span style="color:#e1e4e8;">  Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#e1e4e8;">    enumberable: true, // 可枚举</span></span>
<span class="line"><span style="color:#e1e4e8;">    configurable: true, // 可配置</span></span>
<span class="line"><span style="color:#e1e4e8;">    get: function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">      console.log(&#39;get&#39;, value)</span></span>
<span class="line"><span style="color:#e1e4e8;">      return value;</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">    set: function(newVal) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      console.log(&#39;set&#39;, newVal);</span></span>
<span class="line"><span style="color:#e1e4e8;">      observer(newVal) // 劫持新值</span></span>
<span class="line"><span style="color:#e1e4e8;">      if(newVal !== value) { </span></span>
<span class="line"><span style="color:#e1e4e8;">          value = newVal;      </span></span>
<span class="line"><span style="color:#e1e4e8;">       }</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">  })</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">observer(data);</span></span>
<span class="line"><span style="color:#e1e4e8;">data.title // get vue</span></span>
<span class="line"><span style="color:#e1e4e8;">data.obj = {</span></span>
<span class="line"><span style="color:#e1e4e8;">  age: 60</span></span>
<span class="line"><span style="color:#e1e4e8;">} // set { age: 60 }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">var data = {</span></span>
<span class="line"><span style="color:#24292e;">  title: &#39;Vue&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  obj: {</span></span>
<span class="line"><span style="color:#24292e;">    age: 6</span></span>
<span class="line"><span style="color:#24292e;">  }  </span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">function observer(data) {</span></span>
<span class="line"><span style="color:#24292e;">  if(data &amp;&amp; typeof data == &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#24292e;">    Object.keys(data).forEach(function(key) {</span></span>
<span class="line"><span style="color:#24292e;">      defineReactive(data, key, data[key]);</span></span>
<span class="line"><span style="color:#24292e;">    })</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">function defineReactive(data, key, value) {</span></span>
<span class="line"><span style="color:#24292e;">  observer(value); // 劫持每一层数据</span></span>
<span class="line"><span style="color:#24292e;">  Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#24292e;">    enumberable: true, // 可枚举</span></span>
<span class="line"><span style="color:#24292e;">    configurable: true, // 可配置</span></span>
<span class="line"><span style="color:#24292e;">    get: function() {</span></span>
<span class="line"><span style="color:#24292e;">      console.log(&#39;get&#39;, value)</span></span>
<span class="line"><span style="color:#24292e;">      return value;</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">    set: function(newVal) {</span></span>
<span class="line"><span style="color:#24292e;">      console.log(&#39;set&#39;, newVal);</span></span>
<span class="line"><span style="color:#24292e;">      observer(newVal) // 劫持新值</span></span>
<span class="line"><span style="color:#24292e;">      if(newVal !== value) { </span></span>
<span class="line"><span style="color:#24292e;">          value = newVal;      </span></span>
<span class="line"><span style="color:#24292e;">       }</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">  })</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">observer(data);</span></span>
<span class="line"><span style="color:#24292e;">data.title // get vue</span></span>
<span class="line"><span style="color:#24292e;">data.obj = {</span></span>
<span class="line"><span style="color:#24292e;">  age: 60</span></span>
<span class="line"><span style="color:#24292e;">} // set { age: 60 }</span></span></code></pre></div><p>函数observe传入一个需要被追踪变化的对象data，遍历对象每个属性都使用defineReactive处理，实现侦测对象变化。</p><p>侦测Vue中的data数据。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">function Vue(options) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.$el = options.el;</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.$data = options.data;</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.$options = options;</span></span>
<span class="line"><span style="color:#e1e4e8;">  if(this.$el) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    observer(this.$data);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">function Vue(options) {</span></span>
<span class="line"><span style="color:#24292e;">  this.$el = options.el;</span></span>
<span class="line"><span style="color:#24292e;">  this.$data = options.data;</span></span>
<span class="line"><span style="color:#24292e;">  this.$options = options;</span></span>
<span class="line"><span style="color:#24292e;">  if(this.$el) {</span></span>
<span class="line"><span style="color:#24292e;">    observer(this.$data);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>只需要new Vue一个对象，就会将data中数据进行追踪变化。</p><p>需要注意的是Object.defineProperty有以下缺点：</p><ul><li>无法检测对象属性的添加和删除</li></ul><p>因为Vue通过Object.defineProperty将对象的key转化成getter/setter依赖追踪变化，而getter/setter只能追踪数据是否被修改，却无法追踪新增属性和删除属性。</p><p>对于新增属性，使用Vue.set()方法，可以将新增属性添加到Vue响应式系统中；如：在data对象下新增一个size属性，使用Vue.set(data, &#39;size&#39;, &#39;10KB&#39;)，参数依次是：目标对象，目标对象新增属性，目标对象新增属性值。</p><p>也可以给这个对象重新赋值，如：Vue.set(data, &#39;title&#39;, &#39;MVue&#39;) 。</p><p>对于删除属性，使用Vue.delete(目标对象, 删除目标对象属性)；如：Vue.delete(data, &#39;obj&#39;)。</p><ul><li>不能监听数组变化，可以对数组方法进行重写(参考深入浅出Vue.js)</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">var arr = [&#39;小社区&#39;, &#39;社区&#39;, &#39;大社区&#39;];</span></span>
<span class="line"><span style="color:#e1e4e8;">// 定义数组方法</span></span>
<span class="line"><span style="color:#e1e4e8;">var arrMethods = [&#39;push&#39;, &#39;shift&#39;, &#39;pop&#39;, &#39;unshift&#39;];</span></span>
<span class="line"><span style="color:#e1e4e8;">// 获取数组原型</span></span>
<span class="line"><span style="color:#e1e4e8;">var arr_proto = Array.prototype;</span></span>
<span class="line"><span style="color:#e1e4e8;">// 创建新原型对象</span></span>
<span class="line"><span style="color:#e1e4e8;">var _proto = Object.create(arr_proto); </span></span>
<span class="line"><span style="color:#e1e4e8;">arrMethods.forEach(function(method) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  _proto[method] = function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">      var res = arr_proto[method].call(this, ...arguments);     </span></span>
<span class="line"><span style="color:#e1e4e8;">      return res;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">function observer(data) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  if(Array.isArray(data)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      data.__proto__ = _proto;</span></span>
<span class="line"><span style="color:#e1e4e8;">      return;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">  if(data &amp;&amp; typeof data == &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    Object.keys(data).forEach(function(key) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      defineReactive(data, key, data[key]);</span></span>
<span class="line"><span style="color:#e1e4e8;">    })</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">} </span></span>
<span class="line"><span style="color:#e1e4e8;">function defineReactive(data, key, value) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  observer(value);</span></span>
<span class="line"><span style="color:#e1e4e8;">  Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#e1e4e8;">    enumberable: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">    configurable: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">    get: function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">      console.log(&#39;get&#39;, value);</span></span>
<span class="line"><span style="color:#e1e4e8;">      return value;</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">    set: function(newVal) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      console.log(&#39;set&#39;, newVal);</span></span>
<span class="line"><span style="color:#e1e4e8;">      observer(newVal);</span></span>
<span class="line"><span style="color:#e1e4e8;">      if(newVal !== value) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        value = newVal;</span></span>
<span class="line"><span style="color:#e1e4e8;">      }</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">  })</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">//添加属性重新赋值给新的对象</span></span>
<span class="line"><span style="color:#e1e4e8;">function $set(data, key, value) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  defineProperty(data, key, value);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">observer(arr);</span></span>
<span class="line"><span style="color:#e1e4e8;">arr.shift(); // 使用定义数组中方法</span></span>
<span class="line"><span style="color:#e1e4e8;">console.log(obj); // [&quot;社区&quot;, &quot;大社区&quot;]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">var arr = [&#39;小社区&#39;, &#39;社区&#39;, &#39;大社区&#39;];</span></span>
<span class="line"><span style="color:#24292e;">// 定义数组方法</span></span>
<span class="line"><span style="color:#24292e;">var arrMethods = [&#39;push&#39;, &#39;shift&#39;, &#39;pop&#39;, &#39;unshift&#39;];</span></span>
<span class="line"><span style="color:#24292e;">// 获取数组原型</span></span>
<span class="line"><span style="color:#24292e;">var arr_proto = Array.prototype;</span></span>
<span class="line"><span style="color:#24292e;">// 创建新原型对象</span></span>
<span class="line"><span style="color:#24292e;">var _proto = Object.create(arr_proto); </span></span>
<span class="line"><span style="color:#24292e;">arrMethods.forEach(function(method) {</span></span>
<span class="line"><span style="color:#24292e;">  _proto[method] = function() {</span></span>
<span class="line"><span style="color:#24292e;">      var res = arr_proto[method].call(this, ...arguments);     </span></span>
<span class="line"><span style="color:#24292e;">      return res;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">function observer(data) {</span></span>
<span class="line"><span style="color:#24292e;">  if(Array.isArray(data)) {</span></span>
<span class="line"><span style="color:#24292e;">      data.__proto__ = _proto;</span></span>
<span class="line"><span style="color:#24292e;">      return;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">  if(data &amp;&amp; typeof data == &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#24292e;">    Object.keys(data).forEach(function(key) {</span></span>
<span class="line"><span style="color:#24292e;">      defineReactive(data, key, data[key]);</span></span>
<span class="line"><span style="color:#24292e;">    })</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">} </span></span>
<span class="line"><span style="color:#24292e;">function defineReactive(data, key, value) {</span></span>
<span class="line"><span style="color:#24292e;">  observer(value);</span></span>
<span class="line"><span style="color:#24292e;">  Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#24292e;">    enumberable: true,</span></span>
<span class="line"><span style="color:#24292e;">    configurable: true,</span></span>
<span class="line"><span style="color:#24292e;">    get: function() {</span></span>
<span class="line"><span style="color:#24292e;">      console.log(&#39;get&#39;, value);</span></span>
<span class="line"><span style="color:#24292e;">      return value;</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">    set: function(newVal) {</span></span>
<span class="line"><span style="color:#24292e;">      console.log(&#39;set&#39;, newVal);</span></span>
<span class="line"><span style="color:#24292e;">      observer(newVal);</span></span>
<span class="line"><span style="color:#24292e;">      if(newVal !== value) {</span></span>
<span class="line"><span style="color:#24292e;">        value = newVal;</span></span>
<span class="line"><span style="color:#24292e;">      }</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">  })</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">//添加属性重新赋值给新的对象</span></span>
<span class="line"><span style="color:#24292e;">function $set(data, key, value) {</span></span>
<span class="line"><span style="color:#24292e;">  defineProperty(data, key, value);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">observer(arr);</span></span>
<span class="line"><span style="color:#24292e;">arr.shift(); // 使用定义数组中方法</span></span>
<span class="line"><span style="color:#24292e;">console.log(obj); // [&quot;社区&quot;, &quot;大社区&quot;]</span></span></code></pre></div><p>上述把数组原自带的方法进行重写，覆盖掉原数组方法；重写后的数组方法需要被拦截，但是Vue对这些重写的方法是拦截不到的，也就不能响应。</p><p>比如：修改上述数组某一项值，无法侦测数组变化。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">arr[1] = &#39;物业&#39;;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">arr[1] = &#39;物业&#39;;</span></span></code></pre></div><p>Vue3.x使用proxy作为实现代理，proxy具有代理、拦截与劫持的特征。</p><p>proxy实现特征：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">let arr = [&#39;小社区&#39;, &#39;社区&#39;， &#39;大社区&#39;];</span></span>
<span class="line"><span style="color:#e1e4e8;">let handler = {</span></span>
<span class="line"><span style="color:#e1e4e8;">  get(data, key) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    if(typeof data[key] == &#39;object&#39; &amp;&amp; </span></span>
<span class="line"><span style="color:#e1e4e8;">    data[key] !== null) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      return new Proxy(data[key], handler);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    return Reflect.get(data, key);</span></span>
<span class="line"><span style="color:#e1e4e8;">  },</span></span>
<span class="line"><span style="color:#e1e4e8;">  set(data, key, value) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    if(key == &#39;length&#39;) return true;</span></span>
<span class="line"><span style="color:#e1e4e8;">    return Reflect.set(data, key, value);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">let proxy = new Proxy(arr, handler);</span></span>
<span class="line"><span style="color:#e1e4e8;">proxy[0] = &#39;物业&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">console.log(proxy); // Proxy {0: &quot;物业&quot;, 1: &quot;社区&quot;, 2: &quot;大社区&quot;}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">let arr = [&#39;小社区&#39;, &#39;社区&#39;， &#39;大社区&#39;];</span></span>
<span class="line"><span style="color:#24292e;">let handler = {</span></span>
<span class="line"><span style="color:#24292e;">  get(data, key) {</span></span>
<span class="line"><span style="color:#24292e;">    if(typeof data[key] == &#39;object&#39; &amp;&amp; </span></span>
<span class="line"><span style="color:#24292e;">    data[key] !== null) {</span></span>
<span class="line"><span style="color:#24292e;">      return new Proxy(data[key], handler);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    return Reflect.get(data, key);</span></span>
<span class="line"><span style="color:#24292e;">  },</span></span>
<span class="line"><span style="color:#24292e;">  set(data, key, value) {</span></span>
<span class="line"><span style="color:#24292e;">    if(key == &#39;length&#39;) return true;</span></span>
<span class="line"><span style="color:#24292e;">    return Reflect.set(data, key, value);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">let proxy = new Proxy(arr, handler);</span></span>
<span class="line"><span style="color:#24292e;">proxy[0] = &#39;物业&#39;;</span></span>
<span class="line"><span style="color:#24292e;">console.log(proxy); // Proxy {0: &quot;物业&quot;, 1: &quot;社区&quot;, 2: &quot;大社区&quot;}</span></span></code></pre></div><p>对比Object.defineProperty与proxy：</p><p>Object.defineProperty必须遍历对象每个属性；无法检测对象属性的新增属性与删除属性；无法监听重写数组方法的变化。</p><p>proxy只需做一层代理就能监听同级结构下所有属性，支持代理数组变化。(深层次的数据结构，还是需要递归)</p><h3 id="收集依赖" tabindex="-1">收集依赖 <a class="header-anchor" href="#收集依赖" aria-label="Permalink to &quot;收集依赖&quot;">​</a></h3><p>观察数据目的是当数据属性发生变化时，可以通知那些使用了该数据的地方。</p><p>比如：开篇用到的数据num，当数据num发生变化时，会通知所有用到数据num的地方。</p><p>如果是多个Vue实例共用一个变量，比如：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">var str = &#39;Vue&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">var vm1 = new Vue({</span></span>
<span class="line"><span style="color:#e1e4e8;">  data: str,</span></span>
<span class="line"><span style="color:#e1e4e8;">  template: &#39;&lt;div&gt; {{ str }} &lt;/div&gt;&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">var vm2 = new Vue({</span></span>
<span class="line"><span style="color:#e1e4e8;">  data: str,</span></span>
<span class="line"><span style="color:#e1e4e8;">  template: &#39;&lt;div&gt; {{ str }} &lt;/div&gt;&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">var str = &#39;Vue&#39;;</span></span>
<span class="line"><span style="color:#24292e;">var vm1 = new Vue({</span></span>
<span class="line"><span style="color:#24292e;">  data: str,</span></span>
<span class="line"><span style="color:#24292e;">  template: &#39;&lt;div&gt; {{ str }} &lt;/div&gt;&#39;</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">var vm2 = new Vue({</span></span>
<span class="line"><span style="color:#24292e;">  data: str,</span></span>
<span class="line"><span style="color:#24292e;">  template: &#39;&lt;div&gt; {{ str }} &lt;/div&gt;&#39;</span></span>
<span class="line"><span style="color:#24292e;">})</span></span></code></pre></div><p>此时更改str属性值，这两个实例视图会更新。那么只有通过收集依赖才能知道哪些地方依赖了数据str，以及数据str派发更新数据。</p><p>收集依赖核心思想是事件发布订阅模式，这里有两个角色：订阅者Dep和观察者Watcher。</p><p>收集依赖是为依赖寻找一个存储依赖的地方，因此创建了Dep。使用订阅者Dep用来收集依赖，删除依赖、向依赖发送消息。</p><p>简单实现订阅者Dep：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">function Dep() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.subs = []; // 存储Watcher</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">Dep.prototype.addSub = function(sub) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.subs.push(sub); // 添加Watcher</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">Dep.prototype.notify = function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.subs.forEach(function(sub) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    sub.update(); // 通知Watcher更新视图</span></span>
<span class="line"><span style="color:#e1e4e8;">  })</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">function Dep() {</span></span>
<span class="line"><span style="color:#24292e;">  this.subs = []; // 存储Watcher</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">Dep.prototype.addSub = function(sub) {</span></span>
<span class="line"><span style="color:#24292e;">  this.subs.push(sub); // 添加Watcher</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">Dep.prototype.notify = function() {</span></span>
<span class="line"><span style="color:#24292e;">  this.subs.forEach(function(sub) {</span></span>
<span class="line"><span style="color:#24292e;">    sub.update(); // 通知Watcher更新视图</span></span>
<span class="line"><span style="color:#24292e;">  })</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>从上面代码订阅者Dep的作用是存储观察者Watcher，可以把观察者Watcher理解成一个中转站，当数据发生变化时通知观察者Watcher，再有观察者Watcher通知其他地方。</p><p>当需要依赖收集时调用函数addSub，当需要派发更新时调用函数notify。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">var dep = new Dep();</span></span>
<span class="line"><span style="color:#e1e4e8;">dep.addSub(function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(&#39;add&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">dep.notify();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">var dep = new Dep();</span></span>
<span class="line"><span style="color:#24292e;">dep.addSub(function() {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(&#39;add&#39;)</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">dep.notify();</span></span></code></pre></div><p>如何收集依赖：在getter中收集依赖，在setter中触发依赖；就是把用到该数据的地方收集起来，等到属性发生变化时，把之前收集好的依赖循环触发一边。</p><p>具体是当外界通过观察者Watcher读取数据时就会触发getter，将观察者Watcher添加到依赖中。哪个观察者Watcher触发getter就把哪个观察者Watcher收集到Dep中；当数据发生变化时，会循环依赖列表，把所有的观察者Watcher都通知一遍。</p><h3 id="观察者watcher" tabindex="-1">观察者Watcher <a class="header-anchor" href="#观察者watcher" aria-label="Permalink to &quot;观察者Watcher&quot;">​</a></h3><p>Vue官方定义一个Watcher类用来表示观察订阅依赖。其中《深入浅出Vue.js》给出这样的解释：为什么要引入观察者Watcher。</p><p>在属性发生变化后，需要通知用到该数据的地方。而该数据可能被很多地方用到，并且类型还不一样，可能是模版，可能是开发者编写的watch。这时候需要抽象出一个能集中处理这些情况的类，然后在依赖收集阶段只收集这个封装好的类的实例，通知也只通知这个封装好的类的实例，再由这个封装好的类的实例通知到其他。</p><p>依赖收集的目的是将观察者Watcher存放到当前订阅者Dep的subs中。</p><p>简单实现观察者Watcher：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">function Watcher(data, key, cb) { // cb -&gt;callback缩写</span></span>
<span class="line"><span style="color:#e1e4e8;">  Dep.target = this;</span></span>
<span class="line"><span style="color:#e1e4e8;">  // Dep.target 指向自己，在触发getter时添加监听</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.data = data;</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.key = key;</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.cb = cb;</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.value = data[key];</span></span>
<span class="line"><span style="color:#e1e4e8;">  Dep.target = null; </span></span>
<span class="line"><span style="color:#e1e4e8;">  // 如果不为null，每次都追加一个Dep</span></span>
<span class="line"><span style="color:#e1e4e8;">  // 比如：第一次是[&#39;Dep&#39;], 第二次是[&#39;Dep&#39;, &#39;Dep&#39;], ...</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">Watcher.prototype.update = function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.value = this.data[this.key];</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.cb(this.value);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">function Watcher(data, key, cb) { // cb -&gt;callback缩写</span></span>
<span class="line"><span style="color:#24292e;">  Dep.target = this;</span></span>
<span class="line"><span style="color:#24292e;">  // Dep.target 指向自己，在触发getter时添加监听</span></span>
<span class="line"><span style="color:#24292e;">  this.data = data;</span></span>
<span class="line"><span style="color:#24292e;">  this.key = key;</span></span>
<span class="line"><span style="color:#24292e;">  this.cb = cb;</span></span>
<span class="line"><span style="color:#24292e;">  this.value = data[key];</span></span>
<span class="line"><span style="color:#24292e;">  Dep.target = null; </span></span>
<span class="line"><span style="color:#24292e;">  // 如果不为null，每次都追加一个Dep</span></span>
<span class="line"><span style="color:#24292e;">  // 比如：第一次是[&#39;Dep&#39;], 第二次是[&#39;Dep&#39;, &#39;Dep&#39;], ...</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">Watcher.prototype.update = function() {</span></span>
<span class="line"><span style="color:#24292e;">  this.value = this.data[this.key];</span></span>
<span class="line"><span style="color:#24292e;">  this.cb(this.value);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>执行构造函数把Dep.target指向自身，收集到对应的Watcher，在派发更新时取出对应的观察者Watcher，执行函数update。</p><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>结合以上内容实现一个简单响应式</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">var data = {</span></span>
<span class="line"><span style="color:#e1e4e8;">  title: &#39;vue&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  obj: {</span></span>
<span class="line"><span style="color:#e1e4e8;">    age: 6</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">function Dep() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.subs = [];</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">Dep.prototype.addSub = function(sub) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.subs.push(sub);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">Dep.prototype.notify = function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(&#39;Dep notify&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">  // this.subs.forEach(function(sub) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  // sub.update()</span></span>
<span class="line"><span style="color:#e1e4e8;">  // })</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">function render() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(&#39;模版render...&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">function observer(data) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  if(data &amp;&amp; typeof data == &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    Object.keys(data).forEach(function(key) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      defineReactive(data, key, data[key]);</span></span>
<span class="line"><span style="color:#e1e4e8;">    })</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">function defineReactive(data, key, value) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  observer(value);</span></span>
<span class="line"><span style="color:#e1e4e8;">  var dep = new Dep();</span></span>
<span class="line"><span style="color:#e1e4e8;">  Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#e1e4e8;">    enumberable: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">    configurable: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">    get: function() {</span></span>
<span class="line"><span style="color:#e1e4e8;">      console.log(&#39;get：&#39; value);</span></span>
<span class="line"><span style="color:#e1e4e8;">      Dep.target &amp;&amp; dep.addSub(Dep.target);</span></span>
<span class="line"><span style="color:#e1e4e8;">      return value;</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">    set: function (newVal) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      console.log(&#39;set：&#39;, newVal);</span></span>
<span class="line"><span style="color:#e1e4e8;">      if(newVal !== value) {</span></span>
<span class="line"><span style="color:#e1e4e8;">        value = newVal;</span></span>
<span class="line"><span style="color:#e1e4e8;">        dep.notify();</span></span>
<span class="line"><span style="color:#e1e4e8;">        render();</span></span>
<span class="line"><span style="color:#e1e4e8;">      }</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">  })</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">function MVue(options) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.$options = options;</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.$el = options.el;</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.$data = options.data;</span></span>
<span class="line"><span style="color:#e1e4e8;">  if(this.$el) observer(this.$data);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">new MVue({</span></span>
<span class="line"><span style="color:#e1e4e8;">  el: &#39;#app&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  data: data</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">data.title; // 首次访问数据</span></span>
<span class="line"><span style="color:#e1e4e8;">data.title = &#39;MVue&#39;; // 修改数据</span></span>
<span class="line"><span style="color:#e1e4e8;">data.title; // 访问修改后的数据</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">var data = {</span></span>
<span class="line"><span style="color:#24292e;">  title: &#39;vue&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  obj: {</span></span>
<span class="line"><span style="color:#24292e;">    age: 6</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">function Dep() {</span></span>
<span class="line"><span style="color:#24292e;">  this.subs = [];</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">Dep.prototype.addSub = function(sub) {</span></span>
<span class="line"><span style="color:#24292e;">  this.subs.push(sub);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">Dep.prototype.notify = function() {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(&#39;Dep notify&#39;);</span></span>
<span class="line"><span style="color:#24292e;">  // this.subs.forEach(function(sub) {</span></span>
<span class="line"><span style="color:#24292e;">  // sub.update()</span></span>
<span class="line"><span style="color:#24292e;">  // })</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">function render() {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(&#39;模版render...&#39;);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">function observer(data) {</span></span>
<span class="line"><span style="color:#24292e;">  if(data &amp;&amp; typeof data == &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#24292e;">    Object.keys(data).forEach(function(key) {</span></span>
<span class="line"><span style="color:#24292e;">      defineReactive(data, key, data[key]);</span></span>
<span class="line"><span style="color:#24292e;">    })</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">function defineReactive(data, key, value) {</span></span>
<span class="line"><span style="color:#24292e;">  observer(value);</span></span>
<span class="line"><span style="color:#24292e;">  var dep = new Dep();</span></span>
<span class="line"><span style="color:#24292e;">  Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#24292e;">    enumberable: true,</span></span>
<span class="line"><span style="color:#24292e;">    configurable: true,</span></span>
<span class="line"><span style="color:#24292e;">    get: function() {</span></span>
<span class="line"><span style="color:#24292e;">      console.log(&#39;get：&#39; value);</span></span>
<span class="line"><span style="color:#24292e;">      Dep.target &amp;&amp; dep.addSub(Dep.target);</span></span>
<span class="line"><span style="color:#24292e;">      return value;</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">    set: function (newVal) {</span></span>
<span class="line"><span style="color:#24292e;">      console.log(&#39;set：&#39;, newVal);</span></span>
<span class="line"><span style="color:#24292e;">      if(newVal !== value) {</span></span>
<span class="line"><span style="color:#24292e;">        value = newVal;</span></span>
<span class="line"><span style="color:#24292e;">        dep.notify();</span></span>
<span class="line"><span style="color:#24292e;">        render();</span></span>
<span class="line"><span style="color:#24292e;">      }</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">  })</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">function MVue(options) {</span></span>
<span class="line"><span style="color:#24292e;">  this.$options = options;</span></span>
<span class="line"><span style="color:#24292e;">  this.$el = options.el;</span></span>
<span class="line"><span style="color:#24292e;">  this.$data = options.data;</span></span>
<span class="line"><span style="color:#24292e;">  if(this.$el) observer(this.$data);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">new MVue({</span></span>
<span class="line"><span style="color:#24292e;">  el: &#39;#app&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  data: data</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">data.title; // 首次访问数据</span></span>
<span class="line"><span style="color:#24292e;">data.title = &#39;MVue&#39;; // 修改数据</span></span>
<span class="line"><span style="color:#24292e;">data.title; // 访问修改后的数据</span></span></code></pre></div><p>函数render被渲染时，读取所需对象的值，会触发getter方法把当前观察者Watcher收集到函数Dep中；如果需要修改对象的值，会触发setter方法，通知函数Dep中的notify方法，触发所有观察者Watcher对象中的update方法更新对应视图。</p><p>总结Vue响应式原理</p><p>通过数据劫持结合订阅与发布者模式的方式，通过Object.defineProperty劫持各个属性的getter/setter，在数据发生变化时发布消息给订阅者，触发相应的回调函数。</p><p>执行new Vue整个过程发生了：</p><p>new Vue后，Vue会调用函数_init进行初始化。在这个过程data通过函数observer转化成getter/setter追踪数据变化；当被设置的对象被读取时会执行getter方法，当对象被重新赋值时会执行setter方法。</p><p>函数render执行时，会读取所需对象的值，会触发getter方法把观察者Watcher添加到依赖中进行依赖收集。</p><p>修改对象的值时，会触发相应的setter方法；setter方法通知之前依赖收集得到的Dep中每一个观察者Watcher，再有观察者Watcher通知其他，自己的值被更改了需要重新渲染视图；这时观察者Watcher就会调用update方法更新视图。</p></div></div></main><footer class="VPDocFooter" data-v-40b5f150 data-v-9ea8459c><!--[--><!--]--><!----><nav class="prev-next" data-v-9ea8459c><div class="pager" data-v-9ea8459c><a class="pager-link prev" href="/note/base-reactRouter.html" data-v-9ea8459c><span class="desc" data-v-9ea8459c>Previous page</span><span class="title" data-v-9ea8459c>reactRouter</span></a></div><div class="pager" data-v-9ea8459c><a class="pager-link next" href="/note/vue-for-ref.html" data-v-9ea8459c><span class="desc" data-v-9ea8459c>Next page</span><span class="title" data-v-9ea8459c>ref</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-f07d512f data-v-2b439cc6><div class="container" data-v-2b439cc6><!----><p class="copyright" data-v-2b439cc6>Copyright © 2019-2023 <a href="https://beian.miit.gov.cn">京ICP备13052054号-1</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"404.md\":\"3f091444\",\"index.md\":\"b65d8dec\",\"note_base-flex.md\":\"5e404247\",\"note_clone-javascript.md\":\"792d6575\",\"note_postfrom-jquery.md\":\"ab0f5c07\",\"note_arithmetic-javascript.md\":\"a6d2c015\",\"note_vue-for-ref.md\":\"e5a51996\",\"note_debounce-throttle.md\":\"578a693f\",\"note_javascript-tostring.md\":\"0589a823\",\"note_css-hack.md\":\"882b4192\",\"note_index.md\":\"0bc06fbd\",\"note_base-css-layout.md\":\"027e6bab\",\"note_base-html.md\":\"8c556253\",\"note_elementuiplus-drawer.md\":\"a6d4b45e\",\"note_sort-javascript.md\":\"79f338b7\",\"note_phone-input.md\":\"2bd776fe\",\"note_url-json.md\":\"e5da97fd\",\"note_javascript-stringify.md\":\"a61b2128\",\"note_base-reacthooks.md\":\"72f4d94e\",\"note_web-safe.md\":\"af820aa6\",\"note_base-react16.md\":\"d2d9aae2\",\"note_template-mustache.md\":\"e1db6666\",\"note_css3.md\":\"596de8dc\",\"note_base-reactrouter.md\":\"e91969b8\",\"note_base-webpack.md\":\"66745b6a\",\"note_base-vue.md\":\"53a8e7dc\",\"note_base-vue3.md\":\"3d763c66\",\"note_base-javascript.md\":\"9c758e83\",\"note_base-es6.md\":\"75904bda\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Yuan Blog\",\"description\":\"Just playing around.\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"text\":\"目录\",\"items\":[{\"text\":\"HTML\",\"items\":[{\"text\":\"html基础\",\"link\":\"/note/base-html\"},{\"text\":\"flex基础\",\"link\":\"/note/base-flex\"}]},{\"text\":\"CSS\",\"items\":[{\"text\":\"探索弹性布局\",\"link\":\"/note/base-css-layout\"},{\"text\":\"探索CSS3\",\"link\":\"/note/css3\"},{\"text\":\"css hack\",\"link\":\"/note/css-hack\"}]},{\"text\":\"JsvsScript\",\"items\":[{\"text\":\"JavaScript基础\",\"link\":\"/note/base-javaScript\"},{\"text\":\"stringify的奇妙用法\",\"link\":\"/note/javascript-stringify\"},{\"text\":\"toString的奇妙用法\",\"link\":\"/note/javascript-toString\"},{\"text\":\"操作数组\",\"link\":\"/note/arithmetic-javaScript\"},{\"text\":\"数组中sort的使用\",\"link\":\"/note/sort-javaScript\"},{\"text\":\"节流与防抖\",\"link\":\"/note/debounce-throttle\"},{\"text\":\"模拟form\",\"link\":\"/note/postfrom-jQuery\"},{\"text\":\"url参数转化JSON\",\"link\":\"/note/url-json\"},{\"text\":\"clone\",\"link\":\"/note/clone-javaScript\"}]},{\"text\":\"Mustache\",\"items\":[{\"text\":\"Mustache\",\"link\":\"/note/template-mustache\"}]},{\"text\":\"web safe\",\"items\":[{\"text\":\"学习web safe\",\"link\":\"/note/web-safe\"}]},{\"text\":\"ES6\",\"items\":[{\"text\":\"ES6\",\"link\":\"/note/base-es6\"}]},{\"text\":\"webPack\",\"items\":[{\"text\":\"入门webPack\",\"link\":\"/note/base-webpack\"}]},{\"text\":\"React16.x\",\"items\":[{\"text\":\"React\",\"link\":\"/note/base-react16\"},{\"text\":\"reactHooks\",\"link\":\"/note/base-reactHooks\"},{\"text\":\"reactRouter\",\"link\":\"/note/base-reactRouter\"}]},{\"text\":\"Vue\",\"items\":[{\"text\":\"Vue2\",\"link\":\"/note/base-vue\"},{\"text\":\"ref\",\"link\":\"/note/vue-for-ref\"},{\"text\":\"Vue3\",\"link\":\"/note/base-vue3\"},{\"text\":\"elementPlusDrawer\",\"link\":\"/note/elementUIPlus-drawer\"},{\"text\":\"验证码输入框\",\"link\":\"/note/phone-input\"}]}]}],\"footer\":{\"message\":\"\",\"copyright\":\"Copyright © 2019-2023 <a href=\\\"https://beian.miit.gov.cn\\\">京ICP备13052054号-1</a>\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>